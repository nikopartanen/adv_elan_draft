<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Advanced ELAN manipulation and analysis</title>
  <meta name="description" content="These are teaching materials on Niko Partanen’s course.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Advanced ELAN manipulation and analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are teaching materials on Niko Partanen’s course." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Advanced ELAN manipulation and analysis" />
  
  <meta name="twitter:description" content="These are teaching materials on Niko Partanen’s course." />
  

<meta name="author" content="Niko Partanen">


<meta name="date" content="2017-11-03">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="elan-file-structure.html">
<link rel="next" href="exploring-and-manipulation.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="libs/d3-3.3.8/d3.min.js"></script>
<script src="libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/chromatography-0.1/chromatography.js"></script>
<script src="libs/DiagrammeR-binding-0.9.2/DiagrammeR.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced ELAN</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Info</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-goals"><i class="fa fa-check"></i><b>1.1</b> Course goals</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#course-structure"><i class="fa fa-check"></i><b>1.2</b> Course structure</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.3</b> Schedule</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#resources"><i class="fa fa-check"></i><b>1.4</b> Resources</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#practical-info"><i class="fa fa-check"></i><b>1.5</b> Practical info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#elan-and-praat-strengths-and-weaknesses"><i class="fa fa-check"></i><b>2.1</b> Elan and Praat – strengths and weaknesses</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#linguistic-software"><i class="fa fa-check"></i><b>2.2</b> Linguistic software</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#elan-corpora"><i class="fa fa-check"></i><b>2.3</b> ELAN corpora</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#preprocessing"><i class="fa fa-check"></i><b>2.4</b> Preprocessing</a><ul>
<li class="chapter" data-level="2.4.1" data-path="intro.html"><a href="intro.html#example-of-preprocessing-workflow"><i class="fa fa-check"></i><b>2.4.1</b> Example of preprocessing workflow</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#analysis-workflows"><i class="fa fa-check"></i><b>2.5</b> Analysis workflows</a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#when-to-write-back-to-elan-file"><i class="fa fa-check"></i><b>2.6</b> When to write back to ELAN file</a></li>
<li class="chapter" data-level="2.7" data-path="intro.html"><a href="intro.html#annotations-as-an-independent-dataset"><i class="fa fa-check"></i><b>2.7</b> Annotations as an independent dataset</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>3</b> Tools</a><ul>
<li class="chapter" data-level="3.1" data-path="tools.html"><a href="tools.html#git"><i class="fa fa-check"></i><b>3.1</b> Git</a></li>
<li class="chapter" data-level="3.2" data-path="tools.html"><a href="tools.html#r"><i class="fa fa-check"></i><b>3.2</b> R</a><ul>
<li class="chapter" data-level="3.2.1" data-path="tools.html"><a href="tools.html#tidytext"><i class="fa fa-check"></i><b>3.2.1</b> <code>tidytext</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="tools.html"><a href="tools.html#xml2"><i class="fa fa-check"></i><b>3.2.2</b> <code>xml2</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="tools.html"><a href="tools.html#python"><i class="fa fa-check"></i><b>3.3</b> Python</a><ul>
<li class="chapter" data-level="3.3.1" data-path="tools.html"><a href="tools.html#pympi"><i class="fa fa-check"></i><b>3.3.1</b> <code>pympi</code></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tools.html"><a href="tools.html#anaconda"><i class="fa fa-check"></i><b>3.4</b> Anaconda</a></li>
<li class="chapter" data-level="3.5" data-path="tools.html"><a href="tools.html#reticulate"><i class="fa fa-check"></i><b>3.5</b> reticulate</a></li>
<li class="chapter" data-level="3.6" data-path="tools.html"><a href="tools.html#praatscript"><i class="fa fa-check"></i><b>3.6</b> PraatScript</a></li>
<li class="chapter" data-level="3.7" data-path="tools.html"><a href="tools.html#xpath"><i class="fa fa-check"></i><b>3.7</b> XPath</a><ul>
<li class="chapter" data-level="3.7.1" data-path="tools.html"><a href="tools.html#examples"><i class="fa fa-check"></i><b>3.7.1</b> Examples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="elan-file-structure.html"><a href="elan-file-structure.html"><i class="fa fa-check"></i><b>4</b> ELAN file structure</a><ul>
<li class="chapter" data-level="4.1" data-path="elan-file-structure.html"><a href="elan-file-structure.html#minimal-file"><i class="fa fa-check"></i><b>4.1</b> Minimal file</a><ul>
<li class="chapter" data-level="4.1.1" data-path="elan-file-structure.html"><a href="elan-file-structure.html#participant-name-convention"><i class="fa fa-check"></i><b>4.1.1</b> Participant name convention</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="elan-file-structure.html"><a href="elan-file-structure.html#tier-type-naming-convention"><i class="fa fa-check"></i><b>4.2</b> Tier type naming convention</a></li>
<li class="chapter" data-level="4.3" data-path="elan-file-structure.html"><a href="elan-file-structure.html#hierarchies"><i class="fa fa-check"></i><b>4.3</b> Hierarchies</a></li>
<li class="chapter" data-level="4.4" data-path="elan-file-structure.html"><a href="elan-file-structure.html#discussion"><i class="fa fa-check"></i><b>4.4</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="parsing-elan-files-to-r.html"><a href="parsing-elan-files-to-r.html"><i class="fa fa-check"></i><b>5</b> Parsing ELAN files to R</a><ul>
<li class="chapter" data-level="5.0.1" data-path="parsing-elan-files-to-r.html"><a href="parsing-elan-files-to-r.html#questions"><i class="fa fa-check"></i><b>5.0.1</b> Questions</a></li>
<li class="chapter" data-level="5.0.2" data-path="parsing-elan-files-to-r.html"><a href="parsing-elan-files-to-r.html#example"><i class="fa fa-check"></i><b>5.0.2</b> Example</a></li>
<li class="chapter" data-level="5.1" data-path="parsing-elan-files-to-r.html"><a href="parsing-elan-files-to-r.html#customizing-to-tier-pattern"><i class="fa fa-check"></i><b>5.1</b> Customizing to tier pattern</a></li>
<li class="chapter" data-level="5.2" data-path="parsing-elan-files-to-r.html"><a href="parsing-elan-files-to-r.html#why-to-read-elan-files-into-r"><i class="fa fa-check"></i><b>5.2</b> Why to read ELAN files into R?</a></li>
<li class="chapter" data-level="5.3" data-path="parsing-elan-files-to-r.html"><a href="parsing-elan-files-to-r.html#parsing-with-frelan-package"><i class="fa fa-check"></i><b>5.3</b> Parsing with FRelan package</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html"><i class="fa fa-check"></i><b>6</b> Exploring and manipulation</a><ul>
<li class="chapter" data-level="6.1" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#basic-exploration-with-r"><i class="fa fa-check"></i><b>6.1</b> Basic exploration with R</a><ul>
<li class="chapter" data-level="6.1.1" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#filter"><i class="fa fa-check"></i><b>6.1.1</b> filter()</a></li>
<li class="chapter" data-level="6.1.2" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#slice"><i class="fa fa-check"></i><b>6.1.2</b> slice()</a></li>
<li class="chapter" data-level="6.1.3" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#count-add_count"><i class="fa fa-check"></i><b>6.1.3</b> count(), add_count()</a></li>
<li class="chapter" data-level="6.1.4" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#mutate"><i class="fa fa-check"></i><b>6.1.4</b> mutate</a></li>
<li class="chapter" data-level="6.1.5" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#rename"><i class="fa fa-check"></i><b>6.1.5</b> rename</a></li>
<li class="chapter" data-level="6.1.6" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#lag-lead"><i class="fa fa-check"></i><b>6.1.6</b> lag(), lead()</a></li>
<li class="chapter" data-level="6.1.7" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#str_extract"><i class="fa fa-check"></i><b>6.1.7</b> str_extract()</a></li>
<li class="chapter" data-level="6.1.8" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#str_detect"><i class="fa fa-check"></i><b>6.1.8</b> str_detect()</a></li>
<li class="chapter" data-level="6.1.9" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#if_else"><i class="fa fa-check"></i><b>6.1.9</b> if_else()</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="exploring-and-manipulation.html"><a href="exploring-and-manipulation.html#manipulating-elan-files-with-pympi"><i class="fa fa-check"></i><b>6.2</b> Manipulating ELAN files with Pympi</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="pympi-examples.html"><a href="pympi-examples.html"><i class="fa fa-check"></i><b>7</b> Pympi examples</a><ul>
<li class="chapter" data-level="7.1" data-path="pympi-examples.html"><a href="pympi-examples.html#creating-a-new-elan-file"><i class="fa fa-check"></i><b>7.1</b> Creating a new ELAN file</a></li>
<li class="chapter" data-level="7.2" data-path="pympi-examples.html"><a href="pympi-examples.html#populating-the-elan-file-with-content"><i class="fa fa-check"></i><b>7.2</b> Populating the ELAN file with content</a></li>
<li class="chapter" data-level="7.3" data-path="pympi-examples.html"><a href="pympi-examples.html#merging-elan-files"><i class="fa fa-check"></i><b>7.3</b> Merging ELAN files</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="shiny-components.html"><a href="shiny-components.html"><i class="fa fa-check"></i><b>8</b> Shiny components</a><ul>
<li class="chapter" data-level="8.1" data-path="shiny-components.html"><a href="shiny-components.html#dt"><i class="fa fa-check"></i><b>8.1</b> DT</a></li>
<li class="chapter" data-level="8.2" data-path="shiny-components.html"><a href="shiny-components.html#leaflet"><i class="fa fa-check"></i><b>8.2</b> Leaflet</a></li>
<li class="chapter" data-level="8.3" data-path="shiny-components.html"><a href="shiny-components.html#ggplot2"><i class="fa fa-check"></i><b>8.3</b> ggplot2</a></li>
<li class="chapter" data-level="8.4" data-path="shiny-components.html"><a href="shiny-components.html#advantages-and-disadvantages-of-shiny"><i class="fa fa-check"></i><b>8.4</b> Advantages and disadvantages of Shiny</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="example-interaction-with-emur.html"><a href="example-interaction-with-emur.html"><i class="fa fa-check"></i><b>9</b> Example: Interaction with emuR</a><ul>
<li class="chapter" data-level="9.1" data-path="example-interaction-with-emur.html"><a href="example-interaction-with-emur.html#procedure"><i class="fa fa-check"></i><b>9.1</b> Procedure</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="example-interaction-with-praat.html"><a href="example-interaction-with-praat.html"><i class="fa fa-check"></i><b>10</b> Example: Interaction with Praat</a><ul>
<li class="chapter" data-level="10.1" data-path="example-interaction-with-praat.html"><a href="example-interaction-with-praat.html#research-questions"><i class="fa fa-check"></i><b>10.1</b> Research questions</a></li>
<li class="chapter" data-level="10.2" data-path="example-interaction-with-praat.html"><a href="example-interaction-with-praat.html#implementation"><i class="fa fa-check"></i><b>10.2</b> Implementation</a></li>
<li class="chapter" data-level="10.3" data-path="example-interaction-with-praat.html"><a href="example-interaction-with-praat.html#shiny-application"><i class="fa fa-check"></i><b>10.3</b> Shiny application</a></li>
<li class="chapter" data-level="10.4" data-path="example-interaction-with-praat.html"><a href="example-interaction-with-praat.html#observations"><i class="fa fa-check"></i><b>10.4</b> Observations</a></li>
<li class="chapter" data-level="10.5" data-path="example-interaction-with-praat.html"><a href="example-interaction-with-praat.html#exercise"><i class="fa fa-check"></i><b>10.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="example-concordances-and-map.html"><a href="example-concordances-and-map.html"><i class="fa fa-check"></i><b>11</b> Example: Concordances and map</a><ul>
<li class="chapter" data-level="11.1" data-path="example-concordances-and-map.html"><a href="example-concordances-and-map.html#use"><i class="fa fa-check"></i><b>11.1</b> Use</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="example-preprocessing-workflow.html"><a href="example-preprocessing-workflow.html"><i class="fa fa-check"></i><b>12</b> Example: Preprocessing workflow</a><ul>
<li class="chapter" data-level="12.1" data-path="example-preprocessing-workflow.html"><a href="example-preprocessing-workflow.html#from-points-to-polygon"><i class="fa fa-check"></i><b>12.1</b> From points to polygon</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>13</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Draft version, not to be cited without permission.</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced ELAN manipulation and analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="parsing-elan-files-to-r" class="section level1">
<h1><span class="header-section-number">Section 5</span> Parsing ELAN files to R</h1>
<p>Let’s assume we have a following kind of ELAN file:</p>
<div class="figure">
<img src="https://i.imgur.com/vJQNjb8.png" alt="Example ELAN file" />
<p class="caption">Example ELAN file</p>
</div>
<p>If this would be parsed into R, the expected structure would be something like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">example &lt;-<span class="st"> </span><span class="kw">tribble</span>(<span class="op">~</span>token, <span class="op">~</span>form, <span class="op">~</span>utterance, <span class="op">~</span>reference, <span class="op">~</span>participant, <span class="op">~</span>time_start, <span class="op">~</span>time_end, <span class="op">~</span>filename,
        <span class="st">&#39;words&#39;</span>, <span class="st">&#39;Words&#39;</span>, <span class="st">&#39;Words here.&#39;</span>, <span class="st">&#39;.001&#39;</span>, <span class="st">&#39;Niko&#39;</span>, <span class="dv">0</span>, <span class="dv">1000</span>,  <span class="st">&#39;kpv_izva20171010test.eaf&#39;</span>,
        <span class="st">&#39;here&#39;</span>, <span class="st">&#39;here&#39;</span>, <span class="st">&#39;Words here.&#39;</span>, <span class="st">&#39;.001&#39;</span>, <span class="st">&#39;Niko&#39;</span>, <span class="dv">0</span>, <span class="dv">1000</span>, <span class="st">&#39;kpv_izva20171010test.eaf&#39;</span>,
        <span class="st">&#39;.&#39;</span>, <span class="st">&#39;.&#39;</span>, <span class="st">&#39;Words here.&#39;</span>, <span class="st">&#39;.001&#39;</span>, <span class="st">&#39;Niko&#39;</span>, <span class="dv">0</span>, <span class="dv">1000</span>, <span class="st">&#39;kpv_izva20171010test.eaf&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">session_name =</span> <span class="kw">str_extract</span>(filename, <span class="st">&#39;.+(?=.eaf)&#39;</span>))

example <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">token</th>
<th align="left">form</th>
<th align="left">utterance</th>
<th align="left">reference</th>
<th align="left">participant</th>
<th align="right">time_start</th>
<th align="right">time_end</th>
<th align="left">filename</th>
<th align="left">session_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">words</td>
<td align="left">Words</td>
<td align="left">Words here.</td>
<td align="left">.001</td>
<td align="left">Niko</td>
<td align="right">0</td>
<td align="right">1000</td>
<td align="left">kpv_izva20171010test.eaf</td>
<td align="left">kpv_izva20171010test</td>
</tr>
<tr class="even">
<td align="left">here</td>
<td align="left">here</td>
<td align="left">Words here.</td>
<td align="left">.001</td>
<td align="left">Niko</td>
<td align="right">0</td>
<td align="right">1000</td>
<td align="left">kpv_izva20171010test.eaf</td>
<td align="left">kpv_izva20171010test</td>
</tr>
<tr class="odd">
<td align="left">.</td>
<td align="left">.</td>
<td align="left">Words here.</td>
<td align="left">.001</td>
<td align="left">Niko</td>
<td align="right">0</td>
<td align="right">1000</td>
<td align="left">kpv_izva20171010test.eaf</td>
<td align="left">kpv_izva20171010test</td>
</tr>
</tbody>
</table>
<p>As far as I see, this is what we have in the ELAN file. Of course there are other pieces of information such as annotator, language of the tier, last editing time, media files and so on, but I have not needed those very much myself. The convention I have had with the media files is that each file has media files named identically with the ELAN file itself. Thereby their names (and paths) can be extracted from the ELAN file names if and when needed.</p>
<p>Things can be complicated when there is more content below the tiers. For example, there often are glosses, lemmas and pos-tags below the word tokens. Those will be discussed below.</p>
<p>First I want to mention the possibility to combine metadata into the ELAN files. The starting point here is, usually, that we usually have in this point two values we need: <strong>participant</strong> and <strong>session name</strong>. We didn’t discuss the session names yet, but in my convention each ELAN file has an unique name, and this also serves as the general session name by which this recording instance can be distinguished from the rest.</p>
<p>If we think metadata more generally, we normally have variables which are connected into one of these items. The session itself has a recording place and time, it has files, it has setting, more and genre, for example. The participants themselves have birthtime, age, place of residence, language skills, roles in the recording and so on.</p>
<p>It is important to note that some of the variables listed above are quite different from others. Especially age and role are something that make sense only in the combination of the participant and the recording: the age is always different, and the roles can also vary. We have numerous recordings where the interviewer gets to be the interviewee and vice versa.</p>
<p>So from this point of view the “result” we actually want to work with often looks more like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">place_meta &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">session_name =</span> <span class="kw">c</span>(<span class="st">&#39;kpv_izva20171010test&#39;</span>, <span class="st">&#39;kpv_izva20171015test2&#39;</span>),
         <span class="dt">rec_place =</span> <span class="kw">c</span>(<span class="st">&#39;Paris, France&#39;</span>, <span class="st">&#39;Syktyvkar, Komi&#39;</span>),
         <span class="dt">rec_place_lat =</span> <span class="kw">c</span>(<span class="fl">48.864716</span>, <span class="dv">0</span>),
         <span class="dt">rec_place_lon =</span> <span class="kw">c</span>(<span class="fl">2.349014</span>, <span class="dv">0</span>))

speaker_meta &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">participant =</span> <span class="st">&#39;Niko&#39;</span>,
         <span class="dt">birthplace =</span> <span class="st">&#39;Sulkava, Finland&#39;</span>,
         <span class="dt">bplace_lat =</span> <span class="fl">61.786100</span>,
         <span class="dt">bplace_lon =</span> <span class="fl">28.370586</span>,
         <span class="dt">birthyear =</span> <span class="dv">1986</span>)

corpus &lt;-<span class="st"> </span><span class="kw">left_join</span>(example, place_meta) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(speaker_meta)</code></pre></div>
<pre><code>## Joining, by = &quot;session_name&quot;</code></pre>
<pre><code>## Joining, by = &quot;participant&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corpus</code></pre></div>
<pre><code>## # A tibble: 3 x 16
##   token  form   utterance reference participant time_start time_end
##   &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;
## 1 words Words Words here.      .001        Niko          0     1000
## 2  here  here Words here.      .001        Niko          0     1000
## 3     .     . Words here.      .001        Niko          0     1000
## # ... with 9 more variables: filename &lt;chr&gt;, session_name &lt;chr&gt;,
## #   rec_place &lt;chr&gt;, rec_place_lat &lt;dbl&gt;, rec_place_lon &lt;dbl&gt;,
## #   birthplace &lt;chr&gt;, bplace_lat &lt;dbl&gt;, bplace_lon &lt;dbl&gt;, birthyear &lt;dbl&gt;</code></pre>
<p>As we are joining the tables by participant and session_name, we are able to handle the fact that some variables may have different values in different sessions. For example, in this case the session metadata table contained two different sessions from different years, but when the joins were done the non-matching ones were discarded. This is one of the properties of <code>left_join</code>, there are other join types that are also often useful.</p>
<p>These examples reflect the naming convention that has been used in Freiburg based research projects.</p>
<pre><code>{language}_{variety}{YYYYMMDD}-{Nth-recording}</code></pre>
<p>There are few variations of this, but the basic idea is similar. Some aspects of metadata are stored already in the filenames. I have heard regularly arguments that ideally the filenames would contain absolutely no metadata, which probably is good for personal privacy reasons. However, there are also pragmatic reasons to have filenames contain something that makes them easy or possible to navigate by humans. In the same sense it can be useful to have there some mnemonic element, which we have also at times added into the end, but this alos adds some new problems.</p>
<p>However, having some pieces of information in the filenames allows us to get few more metadata columns in this point:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corpus &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="st">&#39;corpus/&#39;</span>, <span class="dt">pattern =</span> <span class="st">&#39;eaf$&#39;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(read_eaf) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_rows</span>()

<span class="co"># We assume the session name starts with a three letter ISO code</span>
<span class="co"># If the system is entirely reliable, we can just take three first characters</span>
corpus &lt;-<span class="st"> </span>corpus <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">lang =</span> <span class="kw">str_extract</span>(session_name, <span class="st">&#39;.{3}&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">variety =</span> <span class="kw">str_extract</span>(session_name, <span class="st">&#39;(?&lt;=.{3}_)[a-z]+(?=</span><span class="ch">\\</span><span class="st">d)&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rec_year =</span> <span class="kw">as.numeric</span>(<span class="kw">str_extract</span>(session_name, <span class="st">&#39;</span><span class="ch">\\</span><span class="st">d{4}(?=</span><span class="ch">\\</span><span class="st">d{4})&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gender =</span> <span class="kw">str_extract</span>(participant, <span class="st">&#39;(?&lt;=-)(F|M)(?=-)&#39;</span>))

corpus <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(lang, variety, rec_year, gender, <span class="kw">everything</span>()) </code></pre></div>
<pre><code>## # A tibble: 568 x 15
##     lang variety rec_year gender   token
##    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;chr&gt;   &lt;chr&gt;
##  1   kpv    izva     2014      F      ме
##  2   kpv    izva     2014      F       ,
##  3   kpv    izva     2014      F кӧнечнэ
##  4   kpv    izva     2014      F      же
##  5   kpv    izva     2014      F       ,
##  6   kpv    izva     2014      F     кык
##  7   kpv    izva     2014      F     лун
##  8   kpv    izva     2014      F    вӧлі
##  9   kpv    izva     2014      F       в
## 10   kpv    izva     2014      F    шоке
## # ... with 558 more rows, and 10 more variables: utterance &lt;chr&gt;,
## #   reference &lt;chr&gt;, participant &lt;chr&gt;, time_start &lt;dbl&gt;, time_end &lt;dbl&gt;,
## #   session_name &lt;chr&gt;, filename &lt;chr&gt;, word &lt;chr&gt;, after &lt;chr&gt;,
## #   before &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corpus <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(variety)</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   variety     n
##     &lt;chr&gt; &lt;int&gt;
## 1    izva   348
## 2     udo   220</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corpus <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(gender)</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   gender     n
##    &lt;chr&gt; &lt;int&gt;
## 1      F   281
## 2      M   287</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corpus <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(participant)</code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   participant     n
##         &lt;chr&gt; &lt;int&gt;
## 1  JAI-M-1939   246
## 2  JSS-F-1988   183
## 3  MVF-F-1984    98
## 4  NTP-M-1986    41</code></pre>
<p>This is one place where standardized and cross-comparable metadata would be useful. It seems to me that lots of the metadata conversation has circulated around the archiving and later data foundability needs, but this questions come to us also on very concrete levels. How do we call the columns in an R dataframe? You have to refer to them all the time, so changing it later will break lots of code that worked earlier. I guess having something systematic that works for you is the best solution for now. Probably the naming conventions of different programming languages are also good to be taken into account.</p>
<p>The idea behind the structure in this data frame is that we can consider each token as one observation, and this format with one token per row allows easy plotting and statistical testing without issues. The main issue of this section is that we ultimately have to take quite much time to think from where different pieces of metadata come from, or whether they can or cannot be derived from the data we have at hand.</p>
<div id="questions" class="section level3">
<h3><span class="header-section-number">5.0.1</span> Questions</h3>
<ul>
<li>Places, coordinates?</li>
<li>How exact times we have and need?</li>
<li>Are there some pieces of metadata we need all the time?</li>
<li>What kind of data tends to change?</li>
</ul>
</div>
<div id="example" class="section level3">
<h3><span class="header-section-number">5.0.2</span> Example</h3>
<p>I have written in <a href="http://langdoc.github.io/2016-06-04-ELAN-to-R.html">this blog</a> about more exact conventions in parsing ELAN files, especially within <a href="https://github.com/langdoc/FRelan">FRelan</a> R package that I have built to work with Freiburg project ELAN files. However, I have not been very succesful in getting some system to work so that it would be easily and intuitively adapted into project with an entirely different tier structure. Probably the easiest way is to modify the code every time there is a new tier structure.</p>
</div>
<div id="customizing-to-tier-pattern" class="section level2">
<h2><span class="header-section-number">5.1</span> Customizing to tier pattern</h2>
<p>One of the example files has structure:</p>
<pre><code>|-ref (id)
\- orth (kpv)
  \- word (tokenized from orth)
    \- lemma
      \- pos
\- ft-rus (Russian translation)
\- ft-eng (English translation)
\- note (different notes on utterance level)</code></pre>
<p>The way I usually approach this is to read into R individual tiers, and join them together following the logic by which the ELAN tier structure has been set up.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">read_custom_eaf &lt;-<span class="st"> </span><span class="cf">function</span>(path_to_file){
  
  ref &lt;-<span class="st"> </span>FRelan<span class="op">::</span><span class="kw">read_tier</span>(<span class="dt">eaf_file =</span> path_to_file, <span class="dt">linguistic_type =</span> <span class="st">&quot;refT&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(content, annot_id, participant, time_slot_<span class="dv">1</span>, time_slot_<span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">ref =</span> content) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">ref_id =</span> annot_id)
  
  orth &lt;-<span class="st"> </span>FRelan<span class="op">::</span><span class="kw">read_tier</span>(<span class="dt">eaf_file =</span> path_to_file, <span class="dt">linguistic_type =</span> <span class="st">&quot;orthT&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(content, annot_id, ref_id, participant) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">orth =</span> content) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">orth_id =</span> annot_id)
  
  token &lt;-<span class="st"> </span>FRelan<span class="op">::</span><span class="kw">read_tier</span>(<span class="dt">eaf_file =</span> path_to_file, <span class="dt">linguistic_type =</span> <span class="st">&quot;wordT&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(content, annot_id, ref_id, participant) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">token =</span> content) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">token_id =</span> annot_id) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">orth_id =</span> ref_id)

  lemma &lt;-<span class="st"> </span>FRelan<span class="op">::</span><span class="kw">read_tier</span>(<span class="dt">eaf_file =</span> path_to_file, <span class="dt">linguistic_type =</span> <span class="st">&quot;lemmaT&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(content, annot_id, ref_id, participant) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">lemma =</span> content) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">lemma_id =</span> annot_id) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">token_id =</span> ref_id)
  
  pos &lt;-<span class="st"> </span>FRelan<span class="op">::</span><span class="kw">read_tier</span>(<span class="dt">eaf_file =</span> path_to_file, <span class="dt">linguistic_type =</span> <span class="st">&quot;posT&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(content, ref_id, participant) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">pos =</span> content) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">lemma_id =</span> ref_id)
  
  elan &lt;-<span class="st"> </span><span class="kw">left_join</span>(ref, orth) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">left_join</span>(token) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">left_join</span>(lemma) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">left_join</span>(pos) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(token, lemma, pos, time_slot_<span class="dv">1</span>, time_slot_<span class="dv">2</span>, <span class="kw">everything</span>(), <span class="op">-</span><span class="kw">ends_with</span>(<span class="st">&#39;_id&#39;</span>))
    
  time_slots &lt;-<span class="st"> </span>FRelan<span class="op">::</span><span class="kw">read_timeslots</span>(path_to_file)
  
  elan <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(time_slots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">time_slot_1 =</span> time_slot_id)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">time_start =</span> time_value) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(time_slots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">time_slot_2 =</span> time_slot_id)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">time_end =</span> time_value) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(token, lemma, pos, participant, time_start, time_end, <span class="kw">everything</span>(), <span class="op">-</span><span class="kw">starts_with</span>(<span class="st">&#39;time_slot_&#39;</span>))
}

<span class="kw">read_custom_eaf</span>(<span class="st">&#39;corpus/kpv_udo20120330SazinaJS-encounter.eaf&#39;</span>)</code></pre></div>
<pre><code>## Joining, by = c(&quot;ref_id&quot;, &quot;participant&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;orth_id&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;token_id&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;lemma_id&quot;)</code></pre>
<pre><code>## Joining, by = &quot;time_slot_1&quot;</code></pre>
<pre><code>## Joining, by = &quot;time_slot_2&quot;</code></pre>
<pre><code>## # A tibble: 239 x 8
##    token lemma   pos participant time_start time_end
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1     И     и    CC  NTP-M-1986        170     3730
##  2  эшшӧ  эшшӧ     _  NTP-M-1986        170     3730
##  3  ӧтик  ӧтик   Num  NTP-M-1986        170     3730
##  4   тор   тор     N  NTP-M-1986        170     3730
##  5     ,     ,   CLB  NTP-M-1986        170     3730
##  6   мый   мый    CS  NTP-M-1986        170     3730
##  7 тэнад    тэ  Pron  NTP-M-1986        170     3730
##  8     ,     ,   CLB  NTP-M-1986        170     3730
##  9 тэныд    тэ  Pron  NTP-M-1986        170     3730
## 10   мам   мам     N  NTP-M-1986        170     3730
## # ... with 229 more rows, and 2 more variables: ref &lt;chr&gt;, orth &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_custom_eaf</span>(<span class="st">&#39;corpus/kpv_izva20140330-1-fragment.eaf&#39;</span>)</code></pre></div>
<pre><code>## Joining, by = c(&quot;ref_id&quot;, &quot;participant&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;orth_id&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;token_id&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;lemma_id&quot;)</code></pre>
<pre><code>## Joining, by = &quot;time_slot_1&quot;</code></pre>
<pre><code>## Joining, by = &quot;time_slot_2&quot;</code></pre>
<pre><code>## # A tibble: 98 x 8
##      token lemma   pos participant time_start time_end
##      &lt;chr&gt; &lt;lgl&gt; &lt;lgl&gt;       &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1      Ме    NA    NA  MVF-F-1984          0     6086
##  2       ,    NA    NA  MVF-F-1984          0     6086
##  3 кӧнечнэ    NA    NA  MVF-F-1984          0     6086
##  4      же    NA    NA  MVF-F-1984          0     6086
##  5       ,    NA    NA  MVF-F-1984          0     6086
##  6     кык    NA    NA  MVF-F-1984          0     6086
##  7     лун    NA    NA  MVF-F-1984          0     6086
##  8    вӧлі    NA    NA  MVF-F-1984          0     6086
##  9       в    NA    NA  MVF-F-1984          0     6086
## 10    шоке    NA    NA  MVF-F-1984          0     6086
## # ... with 88 more rows, and 2 more variables: ref &lt;chr&gt;, orth &lt;chr&gt;</code></pre>
<p>In practice the files would be parsed in following manner:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corpus &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="st">&#39;corpus&#39;</span>, <span class="dt">pattern =</span> <span class="st">&#39;eaf$&#39;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(read_custom_eaf) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_rows</span>()</code></pre></div>
<pre><code>## Joining, by = c(&quot;ref_id&quot;, &quot;participant&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;orth_id&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;token_id&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;lemma_id&quot;)</code></pre>
<pre><code>## Joining, by = &quot;time_slot_1&quot;</code></pre>
<pre><code>## Joining, by = &quot;time_slot_2&quot;</code></pre>
<pre><code>## Joining, by = c(&quot;ref_id&quot;, &quot;participant&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;orth_id&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;token_id&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;lemma_id&quot;)</code></pre>
<pre><code>## Joining, by = &quot;time_slot_1&quot;</code></pre>
<pre><code>## Joining, by = &quot;time_slot_2&quot;</code></pre>
<pre><code>## Joining, by = c(&quot;ref_id&quot;, &quot;participant&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;orth_id&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;token_id&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;participant&quot;, &quot;lemma_id&quot;)</code></pre>
<pre><code>## Joining, by = &quot;time_slot_1&quot;</code></pre>
<pre><code>## Joining, by = &quot;time_slot_2&quot;</code></pre>
</div>
<div id="why-to-read-elan-files-into-r" class="section level2">
<h2><span class="header-section-number">5.2</span> Why to read ELAN files into R?</h2>
<p>I have often seen and read the idea that in order to analyze linguistic data in R the first task should be to export data from ELAN into a spreadsheet. The problems with this approachs are manifold:</p>
<ul>
<li>The spreadsheet has to be manually updated every time the ELAN file changes</li>
<li>If the spreadsheet is annotated further, it will not match with the updates done into ELAN files after original export</li>
</ul>
<p>From this point of view the ideal solution would be to store all information into ELAN file and create an automatic export procedure to analyse the data further, or store it in other format such as spreadsheet in case this is needed for some reason.</p>
<p>Only way to keep this working is through meticulous working practices. There is no way over this. However, these practices can be easened and made more robust by adopting workflows which minimize the possibilities to deviate from the convention. The most simple mechanism for this is to have a system that is as minimal as possible, still allowing the tasks we want to achieve.</p>
<p>Unfortunately the situations and the tools we work with are never perfect, and there may be situations where we settle into a workflow far from ideal, due to different constraints: time, practicality, limitations of software. In these cases it is important to notice where these compromises have been made. I have included into each example presented here also the points which will make this procedure difficult to maintain, if these can be easily imagined.</p>
</div>
<div id="parsing-with-frelan-package" class="section level2">
<h2><span class="header-section-number">5.3</span> Parsing with FRelan package</h2>
<p>The function I have in the FRelan package for parsing one tier looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FRelan<span class="op">::</span>read_tier</code></pre></div>
<pre><code>## function(eaf_file = &quot;/Volumes/langdoc/langs/kpv/kpv_izva20140404IgusevJA/kpv_izva20140404IgusevJA.eaf&quot;, linguistic_type = &quot;wordT&quot;, read_file = T, xml_object = F){
## 
##                 `%&gt;%` &lt;- dplyr::`%&gt;%`
## 
##                 if (read_file == F){
## 
##                         file = xml_object
## 
##                         } else {
## 
##                 file &lt;- xml2::read_xml(eaf_file)
## 
##                 }
## 
##                 participants_in_file &lt;- file %&gt;% xml2::xml_find_all(paste0(&quot;//TIER[@LINGUISTIC_TYPE_REF=&#39;&quot;, linguistic_type, &quot;&#39;]&quot;)) %&gt;%
##                         xml2::xml_attr(&quot;PARTICIPANT&quot;)
## 
##                 coerce_data_frame &lt;- function(current_participant){
##                         dplyr::data_frame(
##                                 content = file %&gt;%
##                                         xml2::xml_find_all(
##                                                 paste0(&quot;//TIER[@LINGUISTIC_TYPE_REF=&#39;&quot;, linguistic_type, &quot;&#39; and @PARTICIPANT=&#39;&quot;, current_participant,&quot;&#39;]/ANNOTATION/*/ANNOTATION_VALUE&quot;)) %&gt;%
##                                         xml2::xml_text(),
##                                 annot_id = file %&gt;%
##                                         xml2::xml_find_all(
##                                                 paste0(&quot;//TIER[@LINGUISTIC_TYPE_REF=&#39;&quot;, linguistic_type, &quot;&#39; and @PARTICIPANT=&#39;&quot;, current_participant,&quot;&#39;]/ANNOTATION/*/ANNOTATION_VALUE/..&quot;)) %&gt;%
##                                         xml2::xml_attr(&quot;ANNOTATION_ID&quot;),
##                                 ref_id = file %&gt;%
##                                         xml2::xml_find_all(
##                                                 paste0(&quot;//TIER[@LINGUISTIC_TYPE_REF=&#39;&quot;, linguistic_type, &quot;&#39; and @PARTICIPANT=&#39;&quot;, current_participant,&quot;&#39;]/ANNOTATION/*/ANNOTATION_VALUE/..&quot;)) %&gt;%
##                                         xml2::xml_attr(&quot;ANNOTATION_REF&quot;),
##                                 speaker = current_participant,
##                                 tier_id = file %&gt;%
##                                         xml2::xml_find_all(
##                                                 paste0(&quot;//TIER[@LINGUISTIC_TYPE_REF=&#39;&quot;, linguistic_type, &quot;&#39; and @PARTICIPANT=&#39;&quot;, current_participant,&quot;&#39;]/ANNOTATION/*/ANNOTATION_VALUE/../../..&quot;)) %&gt;%
##                                         xml2::xml_attr(&quot;TIER_ID&quot;),
##                                 type = file %&gt;%
##                                         xml2::xml_find_all(
##                                                 paste0(&quot;//TIER[@LINGUISTIC_TYPE_REF=&#39;&quot;, linguistic_type, &quot;&#39; and @PARTICIPANT=&#39;&quot;, current_participant,&quot;&#39;]/ANNOTATION/*/ANNOTATION_VALUE/../../..&quot;)) %&gt;%
##                                         xml2::xml_attr(&quot;LINGUISTIC_TYPE_REF&quot;),
##                                 time_slot_1 = file %&gt;%
##                                         xml2::xml_find_all(
##                                                 paste0(&quot;//TIER[@LINGUISTIC_TYPE_REF=&#39;&quot;, linguistic_type, &quot;&#39; and @PARTICIPANT=&#39;&quot;, current_participant,&quot;&#39;]/ANNOTATION/*&quot;)) %&gt;%
##                                         xml2::xml_attr(&quot;TIME_SLOT_REF1&quot;),
##                                 time_slot_2 = file %&gt;%
##                                         xml2::xml_find_all(
##                                                 paste0(&quot;//TIER[@LINGUISTIC_TYPE_REF=&#39;&quot;, linguistic_type, &quot;&#39; and @PARTICIPANT=&#39;&quot;, current_participant,&quot;&#39;]/ANNOTATION/*&quot;)) %&gt;%
##                                         xml2::xml_attr(&quot;TIME_SLOT_REF2&quot;))
##                 }
## 
##                 if (length(participants_in_file) != 0){
## 
##                         plyr::ldply(participants_in_file, coerce_data_frame) %&gt;% dplyr::tbl_df() %&gt;% dplyr::rename(participant = speaker)
## 
##                 } else {
## 
##                         all_participants &lt;- file %&gt;% xml2::xml_find_all(&quot;//TIER&quot;) %&gt;%
##                                 xml2::xml_attr(&quot;PARTICIPANT&quot;) %&gt;% unique()
##                         tibble(content = NA,
##                                annot_id = &#39;&#39;,
##                                ref_id = &#39;&#39;,
##                                participant = all_participants,
##                                tier_id = &#39;&#39;,
##                                type = linguistic_type,
##                                time_slot_1 = NA,
##                                time_slot_2 = NA)
## 
##                 }
## 
## 
##         }
## &lt;bytecode: 0x7fabc6558ad8&gt;
## &lt;environment: namespace:FRelan&gt;</code></pre>
<p>It works fine, but I have not yet updated it to use <code>map()</code> function from <code>purrr</code> package. It also has some extra parts in it to parse either an XML file or an XML file already read into memory. We usually want to read several tiers and merge them together, and in this context it is not good to open the XML file again every time we read it, as this would slow the function down very much.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="elan-file-structure.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploring-and-manipulation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["Advanced-ELAN.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
